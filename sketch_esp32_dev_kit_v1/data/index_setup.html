<!DOCTYPE html>
<html>
<head>
  <title>ESP32 DEV KIT V1</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <h1>ESP32 DEV KIT V1</h1>
  <p class="content">
  <button id="button-setup" class="nav-button">Setup</button>
  <button id="button-control" class="nav-button">Control</button>
  <button id="button-info" class="nav-button">Info</button>
  </p>
  <h2>Connectivity</h2>
  <iframe src="/dyn_cfg_wifi.html" height="400"></iframe>
  <h2>Features</h2>
    <form form action="/dyn_feature_add.html">
    <label for="type">Create a new feature:</label>
    <select id="type" class="action-button" name="type">
      <option value="digital_output">Digital output</option>
      <option value="digital_input">Digital input</option>
    </select>

    <button type="submit" class="action-button">Create</button>
  </form>
  <br>

  <div id="iframe-container"></div>

  <script>
    const typeHeights = {
      digital_output: 250,
      digital_input: 250,
    };

    function fetchFeatureList() {
      fetch("/dyn_get_features.json") // Assuming the endpoint is '/features'
        .then(response => response.json())
        .then(data => {
          // Handle the fetched feature data here
          //console.log(data); // For debugging
          data.forEach(createIframe);
        })
        .catch(error => {
          console.error('Error fetching feature list:', error);
          // Handle errors, e.g., display an error message
        });
    }

    function createIframe(feature) {
      const iframe = document.createElement('iframe');
      iframe.id = `iframe-${feature.id}`;
      iframe.src = "/dyn_cfg_" + feature.type + ".html?id=" + feature.id;
      iframe.style.height = typeHeights[feature.type] + 'px'; // Adjust height based on type
      iframe.style.width = '100%'; // Or set a specific width
      document.getElementById('iframe-container').appendChild(iframe);
    }

    // Iterate through the feature list and create iframes
    fetchFeatureList();

  </script>

  <script>
    const button1 = document.getElementById('button-setup');
    const button2 = document.getElementById('button-control');
    const button3 = document.getElementById('button-info');

    button1.addEventListener('click', () => {
      url = '/index_setup.html';
      window.location = url;
    });

    button2.addEventListener('click', () => {
      url = '/index_control.html';
      window.location = url;
    });

    button3.addEventListener('click', () => {
      url = '/index_info.html';
      window.location = url;
    });
  </script>
</body>

</html>
